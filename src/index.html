<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IURIS NATURALIS</title>
    contrato 0x4bF546fC1A24F24c1F88e315B0ED96BF853C3D1a
</head>


<script src="js/ethers-5.2.umd.min.js" type="application/javascript"></script>

<body>
    <h1>IURIS NATURALIS EAS test</h1>
<button id="runattest">GET ATTEST</button>
<button id="runoffchain">OFFCHAIN</button>
<button id="runtimestamp">TIMESTAMP</button>
<button id="runcreatewallet">CREATE WALLET</button>
    
    <script type="module">
        import { EAS, Offchain, SchemaEncoder, SchemaRegistry } from "@ethereum-attestation-service/eas-sdk";
        window.EAS = EAS
        window.Offchain = Offchain
        window.SchemaEncoder = SchemaEncoder
    </script>

    <script>

  document.getElementById('runattest').onclick = attest;
  document.getElementById('runoffchain').onclick = offchain;
  document.getElementById('runtimestamp').onclick = timestamp;
  document.getElementById('runcreatewallet').onclick = createWallet;
  
//   const EASContractAddress = "0xC2679fBD37d54388Ce493F1DB75320D236e1815e"; // Sepolia v0.26
  const EASContractAddress = "0x4200000000000000000000000000000000000021"; // Optimism Goerli v1.0.1
  
  const provider = new ethers.providers.JsonRpcProvider("https://goerli.optimism.io");
//   const provider = new ethers.providers.JsonRpcProvider("https://sepolia.publicgoods.network");
//   const provider = new ethers.JsonRpcProvider("https://goerli.optimism.io");


   
    async function attest() {
    const uid = "0xff08bbf3d3e6e0992fc70ab9b9370416be59e87897c3d42b20549901d2cccc3e";
    const attestation = await eas.getAttestation(uid);
    console.log(attestation);
}
 
    
    async function offchain() {
        console.log('running offchain()')
            const offchain = await eas.getOffchain();
            const schemaEncoder = new SchemaEncoder("uint256 eventId, uint8 voteIndex");
            const encodedData = schemaEncoder.encodeData([
            { name: "eventId", value: 1, type: "uint256" },
            { name: "voteIndex", value: 1, type: "uint8" },
            ]);
            const offchainAttestation = await offchain.signOffchainAttestation({
            recipient: '0xFD50b031E778fAb33DfD2Fc3Ca66a1EeF0652165',
            expirationTime: 0,
            time: 1671219636,
            revocable: true,
            version: 1,
            nonce: 0,
            schema: "0xb16fa048b0d597f5a821747eba64efa4762ee5143e9a80600d0005386edfc995",
            refUID: '0x0000000000000000000000000000000000000000000000000000000000000000',
            data: encodedData,
            }, signer);

    } 



async function timestamp() {
    const eas = await new EAS(EASContractAddress);
    eas.connect(provider);
    const data = ethers.utils.formatBytes32String('0x1234');
    const transaction = await eas.timestamp(data);
    await transaction.wait();
}


async function createWallet() {
const address = wallet.address;
const balance =  await provider.getBalance(address);
console.log('address and balance:', address,  parseInt( balance, 16))
signer = wallet.connect(provider);
    try {
    const network = await provider.getNetwork();
    console.log('Chain Name:', network.name);
    console.log('Chain ID:', network.chainId);
    } catch (error) {
    console.error('Error fetching chain info:', error);
    }
}


async function revokeOffchainAttestation (){
    const eas = new EAS(EASContractAddress);
    eas.connect(provider);
    const data = ethers.utils.formatBytes32String('0x6776de8122c352b4d671003e58ca112aedb99f34c629a1d1fe3b332504e2943a');
    const transaction = await eas.revokeOffchain(data);
    await transaction.wait();
}

async function init() {
        eas = new EAS(EASContractAddress);
        console.log('provider: ', provider)
        eas.connect(provider);
    }

    init()

    </script>
</body>
</html>